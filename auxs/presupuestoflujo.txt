# Flujo de Uso del Módulo de Presupuestos

Este documento describe el flujo de trabajo para la gestión de presupuestos en el sistema, desde la creación de períodos hasta la asignación de partidas y su integración con el proceso de adquisición de activos.

## 1. Creación y Gestión de Períodos Presupuestarios

Los períodos presupuestarios son los contenedores principales para organizar tus presupuestos por rangos de tiempo (ej. anual, trimestral).

*   **Acceder al Módulo:**
    *   En el menú lateral, haz clic en "Presupuestos".
    *   Verás una tabla con los períodos presupuestarios existentes (o vacía si no hay ninguno).

*   **Crear un Nuevo Período:**
    *   Haz clic en el botón "+ Nuevo Período" (visible si tienes el permiso `manage_presupuesto`).
    *   Se abrirá un formulario modal.
    *   **Nombre:** Asigna un nombre descriptivo (ej. "Presupuesto Anual 2025", "Presupuesto Q1 2026").
    *   **Fecha de Inicio:** Selecciona la fecha de inicio del período.
    *   **Fecha de Fin:** Selecciona la fecha de fin del período.
    *   **Estado:** Elige el estado inicial (normalmente "Planificación").
        *   `PLANIFICACION`: El período está en diseño, no se pueden realizar movimientos.
        *   `ACTIVO`: El período está vigente, se pueden realizar movimientos presupuestarios.
        *   `CERRADO`: El período ha finalizado, no se pueden realizar más movimientos.
    *   Haz clic en "Guardar". El nuevo período aparecerá en la tabla.

*   **Editar un Período Existente:**
    *   En la tabla de períodos, haz clic en el icono de lápiz (<Edit />) junto al período que deseas editar.
    *   Se abrirá el formulario modal con los datos precargados.
    *   Realiza los cambios necesarios y haz clic en "Guardar".

*   **Eliminar un Período:**
    *   En la tabla de períodos, haz clic en el icono de papelera (<Trash2 />) junto al período que deseas eliminar.
    *   Confirma la eliminación. Ten en cuenta que esto eliminará también todas las partidas presupuestarias asociadas.

## 2. Gestión de Partidas Presupuestarias dentro de un Período

Las partidas presupuestarias son las líneas específicas de tu presupuesto, asignadas a departamentos y con un monto definido.

*   **Acceder a las Partidas de un Período:**
    *   En la tabla de períodos presupuestarios, haz clic en cualquier fila de un período.
    *   Esto te llevará a una vista detallada de ese período, mostrando una tabla de sus partidas presupuestarias.
    *   Verás el nombre del período y un botón "Volver a Períodos" para regresar a la lista principal.

*   **Crear una Nueva Partida:**
    *   En la vista de partidas de un período, haz clic en el botón "+ Nueva Partida".
    *   Se abrirá un formulario modal.
    *   **Nombre:** Asigna un nombre descriptivo (ej. "Material de Oficina", "Software de Diseño", "Mantenimiento de Equipos").
    *   **Departamento:** Selecciona el departamento al que se asigna esta partida.
    *   **Monto Asignado:** Ingresa el monto total asignado a esta partida.
    *   Haz clic en "Guardar". La nueva partida aparecerá en la tabla.

*   **Editar una Partida Existente:**
    *   En la tabla de partidas, haz clic en el icono de lápiz (<Edit />) junto a la partida que deseas editar.
    *   Se abrirá el formulario modal con los datos precargados.
    *   Realiza los cambios necesarios y haz clic en "Guardar".

*   **Eliminar una Partida:**
    *   En la tabla de partidas, haz clic en el icono de papelera (<Trash2 />) junto a la partida que deseas eliminar.
    *   Confirma la eliminación.

## 3. Integración con el Flujo de Adquisición de Activos

El módulo de presupuestos está integrado con el proceso de adquisición para controlar los gastos.

*   **Solicitud de Compra:**
    *   Al crear o editar una `Solicitud de Compra`, ahora encontrarás un campo para seleccionar la **"Partida Presupuestaria"** a la que se imputará el gasto.
    *   Es crucial seleccionar la partida correcta para que el sistema pueda rastrear el presupuesto.

*   **Orden de Compra y Movimientos Presupuestarios:**
    *   Cuando una `Orden de Compra` asociada a una `Solicitud de Compra` (que tiene una `Partida Presupuestaria` asignada) es marcada como **"Recibida"** (mediante la acción `recibir` en el backend o el botón correspondiente en el frontend), ocurren dos cosas automáticamente:
        1.  Se crea un `ActivoFijo` en el sistema.
        2.  Se genera un `MovimientoPresupuestario` que registra el gasto contra la `Partida Presupuestaria` seleccionada.
        3.  El campo `monto_gastado` de la `PartidaPresupuestaria` se actualiza, reflejando el dinero ya comprometido/gastado.

*   **Visualización de Movimientos Presupuestarios:**
    *   Actualmente, los `MovimientoPresupuestario` se registran automáticamente en el backend. Puedes verlos en el panel de administración de Django.
    *   (Futura mejora: una vista en el frontend para consultar los movimientos de cada partida).

## Consideraciones Importantes:

*   **Permisos:** Asegúrate de tener los permisos adecuados (`manage_presupuesto`) para crear, editar y eliminar períodos y partidas.
*   **Estados del Período:** Solo se pueden realizar movimientos presupuestarios (gastos) en períodos con estado "ACTIVO".
*   **Consistencia:** La correcta asignación de partidas en las solicitudes de compra es fundamental para mantener la integridad del presupuesto.
*   **Monto Total del Período:** El `monto_total` de un `PeriodoPresupuestario` se calcula automáticamente sumando los `monto_asignado` de todas sus `PartidaPresupuestaria`.
*   **Monto Gastado de la Partida:** El `monto_gastado` de una `PartidaPresupuestaria` se actualiza automáticamente con los `MovimientoPresupuestario` generados por las órdenes de compra recibidas.
